# railway.toml
[build]
builder = "NIXPACKS"

[deploy]
startCommand = "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
restartPolicyType = "ON_FAILURE"

[[services]]
name = "api"
source = "."

[services.envs]
DATABASE_URL = { ref = "DATABASE_URL" }
REDIS_URL = { $ref = "REDIS_URL" }
STRIPE_SECRET_KEY = { ref = "STRIPE_SECRET_KEY" }
RESEND_API_KEY = { ref = "RESEND_API_KEY" }
OPENAI_API_KEY = { ref = "OPENAI_API_KEY" }

[[services]]
name = "worker"
source = "."
startCommand = "celery -A app.workers worker --loglevel=info"

[[services]]
name = "websocket"
source = "."
startCommand = "uvicorn app.main:app --host 0.0.0.0 --port $PORT --ws websockets"